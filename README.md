# 🐎 競馬予想モデル（回収率特化型）

「的中率ではなく **回収率を最大化** する」ことを目的とした  
データドリブン型の競馬予想プロジェクトです。

---

## 🎯 目的（Goal）

本モデルは以下の思想で構築されています：

- 期待値（オッズの歪み）を狙う  
- “なんとなく買う”を排除し、判断軸を固定  
- 過去5走を **比較可能な標準スコア** に変換  
- コース適性を **重み付け** で統合  
- 最終的には **勝率 × オッズ = 期待値モデル** へ拡張可能

---

## 🧠 設計思想（Design Philosophy）

### 1. 過去5走の「標準化」

レースごとの条件差（距離・ペース・通過順位など）を吸収し、  
馬の能力だけを比較できるように正規化します。

#### ✔ 距離換算

- 「芝1400」「ダ1200」「1600m」を自動で数値パース  
- 各馬のタイムを **予想レースの距離へ換算**  
- 1F 差ごとに **+0.4 秒の距離補正**

#### ✔ ペース補正

- 上がり：ハイ → プラス補正 / スロー → マイナス補正  
- 先行力：ハイ → 前有利補正 / スロー → 前不利補正  
- レース文脈を反映した公平な評価を実施

---

### 2. 3つの能力スコア

#### 🏃‍♂️ スピードスコア（Speed）

- 距離換算後のタイムを平均化  
- `200 - adjusted_time` で高速ほど高スコアへ統一

#### 🏁 上がり力スコア（Closing）

- 上がり（末脚）の速さを基準化  
- ペース補正込みで「切れ味」を反映

#### 🚀 先行力スコア（Lead）

- 通過順位の先頭側割合（先行力の定量化）  
- フルゲート基準の割合化  
- ペース補正で「本質的な先行力」を抽出

---

### 3. コース適性は重み付けで補正

コースによって重要な能力が違うため、  
**speed / lead / closing に重み付けして総合スコアを算出** します。

例：東京競馬場（上がり性能がより重要）

    speed   × 1.2
    lead    × 0.7
    closing × 1.4

これにより、

**「能力 × コース特性」 = 最適スコア**

が得られます。

---

## 📁 推奨プロジェクト構成

    競馬予想モデル/
    ├── crawl/         # ネット競馬クロール
    ├── preprocess/    # データ前処理（距離パース・標準化）
    ├── scoring/       # speed/lead/closing の3スコア算出
    ├── course/        # コース適性スコア付与
    ├── predict/       # 勝率・期待値モデル（将来）
    └── assets/        # CSV, 学習データ

---

## 📈 今後の拡張計画

- レースレベル補正（相手強さ）  
- 馬場指数（含水率・脚抜き）  
- 斤量補正（+2kg → 0.1〜0.2秒）  
- 騎手 × 調教師 × 馬 × コースの複合スコア  
- 脚質モデル（位置取りシェイプ）  
- LightGBM / XGBoost による勝率推定モデル  
- 期待値自動算出 → 購入判断の自動化

---

## 📝 補足

この README は「目的・設計思想」に絞っています。  
詳細仕様や API ドキュメントは `docs/` に分離可能です。

---

## 👍 ライセンス

自由に利用・改変できます。（後で方針に合わせて変更可能）
